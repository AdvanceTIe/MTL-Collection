<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1, Safari=1,Firefox=1">
   
    <!-- Iconos para pagina -->
    <link rel="manifest" href="/img/ico/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/img/myth-toys-lover.jpg">

    <link rel="icon" type="image/png" href="/img/ico/myth-toys-lover-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/img/ico/myth-toys-lover.svg" />
    <link rel="shortcut icon" href="/img/ico/myth-toys-lover.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/img/ico/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="MyWebSite" />
    <link rel="manifest" href="/site.webmanifest" />

    <meta name="theme-color" content="#ffffff">
    <title>Pago Exitoso - Myth-toys-lover </title>
    <meta name="keywords" content="Saint, Bandai, Escorpio, Myth Cloth, Shiryu, Andromeda"/>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/car.css">
    <link rel="stylesheet" href="/css/product.css">
    <link rel="stylesheet" href="/css/success.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <script src="https://www.paypal.com/sdk/js?client-id=Acsrml6iXJTujkOlbYy-rk7fLFYW6JCrZbiRFLyyBvsqgDaLzyY0ZDlVhv7Q1havDfx8W0I1YFD3T3tE&currency=USD"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <!--
        https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css
        https://api.WhatsApp.com/send?phone=573176473302"
    <script src="js/scriptp.js" defer></script>
    -->
</head>
<body>
    <header>
        <div class="header__container">
            <div class="header__top">
                <div class="logo">
                    <a href="Product.html">
                        <img src="/img/myth-toys-lover.jpg" title="Toys lover" alt="Myth-toys-lover" class="logo__src">
                    </a>
                </div>
                <div class="search__box">
                    <div class="search__wrapper">
                        <i class="fas fa-magnifying-glass search__icon"></i>
                        <input type="search" placeholder="¿Buscar?" id="searchInput">
                    </div>
                </div>
                <div class="social__redes__Apps">
                    <div class="footer__redes__Apps">
                       <!--
                        <a class="facebook" href="#">
                            <i class="fa-brands fa-facebook-f" style="color: #ffffff;"></i>
                        </a> 
                        -->
                        <a class="tik-tok" href="https://www.tiktok.com/@Myth_Toys_Lover" target="_blank" aria-label="Síguenos en TikTok" rel="noopener noreferrer">
                            <i class="fa-brands fa-tiktok"></i>
                        </a>
                        <a class="intagram" href="https://www.instagram.com/Myth_Toys_Lover/" target="_blank" rel="noopener noreferrer">
                            <i class="fa-brands fa-instagram"></i></a>
                        <a class="youtube" href="https://www.youtube.com/@Myth_Toys_Lover" target="_blank" rel="noopener noreferrer">                    
                            <img src="/img/social/youtube_white.svg" width="16px" alt=""> </a>   
                    </div>
                    <div class="car__compras">
                        <a href="/cart.html" id="cart__icon">
                           <!-- <img src="/frontend/img/car-compras.gif" alt=""> <span id="cuenta__Cart">0</span> -->
                            <img src="/img/shopping-card-svgrepo-com.svg" alt=""> <span id="cuenta__Cart">0</span>
                        </a>
                    </div>                  
                 </div>
            </div>
        </div>
    </header>   
    <main class="main__container_payment">
        <div class="payment-wrapper">
             <section class="payment-success">
            <h1> <i class="fas fa-check-circle success-icon"></i> <span>Pago Exitoso</span></h1>
            <!--<p>Detalles:</p>-->
            <div id="payment-details">
                <ul>
                    <li><strong>Fecha del pago:</strong> <span id="created"></span></li>
                    <li><strong>ID-Transacción:</strong> <span id="transaction_id"></span></li>
                    <li><strong>Estado del pago:</strong> <span id="payment-status"></span></li>
                    <li><strong>Monto total:</strong> <span id="total-amount"></span> </li>
                    <li><strong>Moneda:</strong> <span id="currency"></span></li>
                    <li><strong>Nombre:</strong> <span id="customer-name"></span></li>
                    <li><strong>Correo del cliente:</strong> <span id="customer-email"></span></li>
                </ul>
            </div>
            <h3>¡Gracias por tu compra!</h3>
            <br>
            <a class="payment-cont" href="Product.html" class="btn">Seguir Comprando</a>
        </section>
    </div>
    </main>
    <script src="/js/cart.js"></script>

    <footer class="footer__global">
        <div class="footer__container">
        <div class="Copyright">
            <small>
                Copyright &copy; 2025 <b>Myth toys lover</b> - All Rights Reserved
            </small>
        </div>
    </footer>
    <div class="WhatsApp__container">
        <a href="https://wa.me/17868342456?text=Bienvenido a Myth toys lover, !Inicia una chat para ayuarte!!" class="WhatsApp__link" target="_blank">            
            <img class="WhatsApp__boton" src="/img/social/WhatsApp.svg" alt="">
        </a>
    </div>
    <script src="/js/scriptp.js" defer></script>
    <script src="/js/success.js" defer></script>

    <script>
        // Verificar si es un retorno de Stripe
        const urlParams = new URLSearchParams(window.location.search);
        const sessionId = urlParams.get('session_id');
        
        if (sessionId) {
            // Notificar a la ventana padre si existe
            if (window.opener) {
                try {
                    window.opener.postMessage({ type: 'paymentSuccess', sessionId: sessionId }, window.opener.location.origin);
                    window.close();
                } catch (e) {
                    console.error("Error comunicando con ventana padre:", e);
                    // Redirigir al carrito con parámetro de éxito
                    //window.location.href = '/frontend/cart.html?payment_success=true';
                   return;
                    
                }
            } else {
                // Redirigir al carrito con parámetro de éxito
               //window.location.href = '/frontend/cart.html?payment_success=true';
               return;
            }
        }
    
        // Obtener detalles del pago para mostrar en la página
        async function fetchPaymentDetails() {
            if (!sessionId) return;
            
            try {
                const response = await fetch(`https://www.myth-toys-lover.com/payment-details?session_id=${sessionId}`);

                if (!response.ok) throw new Error('Error al obtener detalles');
                
                const data = await response.json();
                
                // Mostrar detalles en la página
                document.getElementById('created').textContent = new Date(data.created * 1000).toLocaleString();
                document.getElementById('transaction_id').textContent = data.transaction_id;
                document.getElementById('payment-status').textContent = data.payment_status;
                document.getElementById('total-amount').textContent = `${data.amount_total} ${data.currency}`;
                document.getElementById('currency').textContent = data.currency;
                document.getElementById('customer-name').textContent = data.customer_name;
                document.getElementById('customer-email').textContent = data.customer_email;
                
            } catch (error) {
                console.error("Error obteniendo detalles del pago:", error);
            }
        }
        
        fetchPaymentDetails();
    </script>
</body>
</html>
